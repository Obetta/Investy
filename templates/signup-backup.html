<!DOCTYPE html>

<head>
    <title>Signup</title>

    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='style.css') }}">

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css" integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">
</head>

<body>
    <h1>Sign-up</h1>
    <!-- changing the href enables me navigate to different pages -->
    <div class="main">
        <p>Please input your user information.</p>
    
        <form class="pure-form" action="/signup" method="POST">
            Firstname: <br>
            <input type="text" name="fname" placeholder="first name"><br>
            <br>

            Lastname: <br>
            <input type="text" name="lname" placeholder="last name"><br>
            <br>

            Phone-number: <br>
            <input type="text" name="phone_number"><br>
            <br>

            Email: <br>
            <input type="text" name="email" placeholder="name@example.com"><br>
            <br>

            Password: <br>
            <input type="text" name="password" placeholder="name@example.com"><br>
            <br>

            <button type="submit" class="btn btn-primary" value="Submit">Submit</button>
            <br>
        </form>
        <small class="mini" id="emailHelp" class="form-text text-muted">-- Or if you already have an account -- </small>
        <br>

        <a href="/login" class="btn btn-info" role="button">Login</a>
    </div>

    <div>
        {% if info %}
            <p>An account with email: {{ info }} already exists</p>
            <br>
        {% endif %}
    </div>
</body>

@app.route('/signup',methods=['POST','GET'])
def signup():
    # info = 0

    fname = str(request.form.get('fname'))
    fname = "'" + fname + "'"
    lname = str(request.form.get('lname'))
    lname = "'" + lname + "'"
    phone_number = str(request.form.get('phone_number'))
    phone_number = "'" + phone_number + "'"
    email = str(request.form.get('email'))
    email = "'" + email + "'"
    pwd = str(request.form.get('password'))
    pwd = "'" + pwd + "'"

    records = mysqlconnector.checkUserExists(email)
    print(records)

    if len(records) != 0:
        print("Account with username already exists")
        print(email)
        return render_template('signup.html', info = email)
    else:
        # create account
        mysqlconnector.createNewUser(fname, lname, phone_number, email, pwd)

        # get newly created account details
        account_detail = mysqlconnector.authorizeUser(email,pwd)

        # set USER_ID
        global USER_ID
        USER_ID = account_detail[0][0]

        # set USER_NAME
        global USER_NAME
        USER_NAME = account_detail[0][1]

        mod_id = int(USER_ID)
        records = mysqlconnector.displayWatchlist(mod_id)

        # render user profild
        return render_template('profile.html',name = USER_NAME, id_ = USER_ID, records = records)